

<!--<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us" xml:lang="en-us" >
<head>
	<title> 
	


	</title>
	
<link rel="stylesheet" type="text/css" href="/media//css/menu.css" media="screen" />
<link rel="stylesheet" type="text/css" href="/media//css/base.css" />

<link rel="stylesheet" type="text/css" href="/media//css/jquery.clockpick.css" />
<link rel="stylesheet" type="text/css" href="/media//css/sf.css" media="screen" />
<link href="/media//css/css.css" rel="stylesheet" />
<link href="/media//css/tabs.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="/media//css/jquery.treeview.css" />
<link rel="stylesheet" type="text/css" href="/media//css/datepiker.css" media="screen" />
<link rel="stylesheet" type="text/css" href="/media//themes//css/skin.css" media="screen" />



	
<script src="/media//jslib/appconfig.js"> </script>
<script src="/media//jslib/i18n.js"></script>
<script src="/media//jslib/jquery.js"></script>
<script src="/media//jslib/jquery.validate.js"></script>
<script src="/media//jslib/i18n_en-us.js"></script>





<script src="/media//jslib/jquery.plus.js"></script>
<script src="/media//jslib/jquery.zcommon.js"></script>
<script src="/media//jslib/widgets.js"></script>
<script src="/media//jslib/jquery.tools.min.js"></script>

<script src="/media//jslib/jquery.zgrid.js"></script>
<script src="/media//jslib/datalist.js"></script>
<script src="/media//jslib/datalistadd.js"></script>
<script src="/media//jslib/report_design.js"></script>


	
	
</head>
<body>
<!-- request.is_ajax-->

	<div style="margin:0px;padding:0px;">
	
		<form method="post" onkeydown="if(event.keyCode==13){return false;}"  id="id_edit_form" enctype="multipart/form-data">
			<input type="hidden" id="id_model_pk" name="pk" value="" />
			<input type="hidden" id="id_model_info"  app_label=""  model_name=""/>
			
<div id="id_span_title" class="portlet-header sfActive">
<span class='icon_SiteMap'>&nbsp;</span>EN: 当前位置：
	 
		<span id="id_rel_log"> -> </span>
	->
</div>
<!-- title -->

			
			<div class="form_help">
			
			<div id="id_help" style="text-align: right;">
				
				<a href='javascript:void(0);' ref="/media//help/en-us//#detail"  ></a>
				
			</div>
			<div class="clear"></div>
			</div>
			<!-- help_panel -->

			

    <div class="div_backup_db">
        <input type="radio" name="backuptype" checked="checked" value='1' id="id_chk_backupNow" >EN: 立即备份</input>
        <br />
		<input type="radio" name="backuptype" value='2' id="id_chk_backupPlan" >EN: 计划备份</input>
        <br />
        <input type="radio" name="backuptype" value='3' id="id_chk_cancelPlan" >EN: 取消计划备份</input>
	</div>

	<div class ="div_box" id="id_div_backupPlan" style="display:none;width:550px;height:60px;">
		<h1>EN: 计划备份</h1>
		<div class="floatL">
		  	EN: 从</div>
			<div class="floatL">
				<div id ="since_first_date">
					<input type="text" size="19" id="id_start" class="wZBaseDateTimeField required" name="start" style="margin-top:2px;_margin-top:0px;">
					<span class="pop_time"> 
						| <a id="clocklink" style="cursor:pointer;"><img alt=Time  src="/media/img/icon_clock.gif" style="_padding-top:2px;margin-right:3px;"></a>
					</span>
			  	</div>
			</div>
			<div class="floatL lineH22">EN: 开始,</div>
			<div class="floatL" style="margin-left:10px;">
				EN: 每隔<input type='text' onkeydown="check_number(this,event)" value='2' id="id_intervaltime" name="intervaltime" style="width:100px" />EN: 天
            </div> 
    </div>
    

<!--operation_panel-->

			<table cellpadding="3" style="margin:0px 10px 0px 10px; position:relative;" class="tbl_data_edit">
			<tr><td clospan="6">
			<div id="id_tabs">
			

			
			</div>
			</td></tr>

			<tr id="pre_addition_fields">
    <th></th>
    <td>
	<table>
		<tr>
			<td><div id="objs_for_op" style="padding:2px;margin:0px 0px 2px 0px;"></div>
			</td>
			<td><div id="id_op_for_model" data=""></div><div id="id_store_select_emp">
				<table id="id_tbl"></table></div>
			</td>
		</tr>
        <tr class="displayN"><th></th><td><input type="checkbox" name="sync_to_branch" class="wZBaseBooleanField" id="id_sync_to_branch"></td></tr>
	</table>
</td>
</tr>

			
			
			<!-- form -->

			<tr id="addition_fields"></tr>
			</table>

			
			
			


		</form>

		<input type="hidden" id="id_query_str" value=""/>

		<div id="id_info"><div>
		<script>
			
   
	var check_number = function(el,ev){
    	var event = ev || window.event;                           
      	var currentKey = event.charCode||event.keyCode;
		if (currentKey!=8 && currentKey != 46 && (currentKey<37 || currentKey>40) && (currentKey<48 || currentKey>57) && (currentKey<96 || currentKey>105))
        {
         	if (window.event)
         	{                   
              	event.returnValue=false;
            }           
          	else
          	{                            
             	event.preventDefault();
            }
        }
    }
    
    var before_submit = function(){
        var type = 0;
        $("input[name='backuptype']").each(function(){
            if($(this).attr("checked"))
            {
                type = $(this).attr("value");
            }
        });
        
        if(type == 2)
        {
            var intervaltime = $("#id_intervaltime").val();
            if(parseInt(intervaltime) > 365)
            {
                alert(gettext("间隔时间不能超过一年"));
                return false;
            }
            
			 if(intervaltime =='')
            {
                alert(gettext("间隔时间不能为空"));
                return false;
            }
			
			 if(parseInt(intervaltime) ==0)
            {
                alert(gettext("间隔时间不能为零"));
                return false;
            }
			
        }

        if(type != 3)
        {
        	var ret = true;
            $.ajax({ 
               type: "POST",
               url: "/BackupDBValidate/"+type,
               dataType: "text",
               async: false,
               success: function(mess){
                   if(mess == "fail")
                   {
                       alert(gettext("在当前时间的一个小时内只能备份一次"));
                       ret = false;
                   }
                   else if(mess == "null")
                   {
                       alert(gettext("请先在服务控制台中设置数据库备份路径"));
                       ret = false;
                   }
                   else if(mess == "notexist")
                   {
                       conf = confirm(gettext("备份路径不存在，是否自动创建？"));
                       if(!conf)
                       {
                           ret = false;
                       } 
                   }else{
                    alert(gettext("数据库将备份到:")+mess)
                }
               }
       		});
       		return ret;
        }
        return true;
    }
    
	$(function(){    
		$.ajax({ 
			type: "POST",
		  	url: "/getBackupsched",
		 	dataType: "json",
		  	async: false,
		  	success:function(json){
				if (json.Info == "OK")
				{
               
                	$("#id_start").val(json.starttime);
                    $("#id_intervaltime").val(json.inc);
                }
                else
               {
                    var date = new Date();
                    var y = date.getFullYear();
                    var m = date.getMonth()+1;
                    var d =  date.getDate();
                    var H = date.getHours()+'';
                    if(H.length == 1)
                    {
                        H = '0'+H;
                    }
                    var M = date.getMinutes();
                    var S = date.getSeconds();
                    $("#id_start").val(y+"-"+m+"-"+d +" " + H+":"+M+":" +S);
                    $("#id_intervaltime").val("2");
               }   
                
			}
		});
	});
	
	$(function(){
		$("input[name='backuptype']").click(function(e){
	 		if($(this).attr("id")=="id_chk_backupPlan")
	 		{
				$("#id_div_backupPlan").show();
			}
			else
			{
				$("#id_div_backupPlan").hide();
			}
		});
	});

    

			var $form=$("#id_edit_form");
			render_widgets($form);
			
			
			after_process=function()
			{
				$("#id_edit_form input[id^='id_']:first").focus();
			}
			
		</script>
		
	</div>
	<!-- content ???-->

</body></html>


